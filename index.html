<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∏îÎ°úÍ∑∏ HTML ÏóêÎîîÌÑ∞ Pro Master ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</title>
    <link rel="icon" type="image/png" href="favicon.png">

    <!-- Libraries (CDN Only) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.css">

    <style>
        /* ============ Professional UI Design System ============ */
        :root {
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.4);
            --bg-dark: #0f172a;
            --bg-darker: #020617;
            --bg-light: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --border: #334155;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode {
            --bg-dark: #000000;
            --bg-darker: #111111;
            --bg-light: #222222;
            --border: #444444;
        }

        body {
            font-family: 'Inter', 'Segoe UI', 'Malgun Gothic', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
            color: var(--text-primary);
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ============ Header & Toolbar ============ */
        .header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(15px);
            border-bottom: 2px solid var(--primary);
            padding: 0.6rem 1.25rem;
            z-index: 100;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.6rem;
        }

        .header h1 {
            font-size: 1.1rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, #818cf8, #c084fc, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .btn {
            padding: 0.4rem 0.75rem;
            border: none;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-1.5px);
            filter: brightness(1.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-secondary {
            background: var(--bg-light);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-icon {
            padding: 0.4rem;
            min-width: 34px;
            justify-content: center;
            font-size: 1.1rem;
        }

        .toolbar-group {
            display: flex;
            background: rgba(255, 255, 255, 0.06);
            padding: 2px;
            border-radius: 10px;
            gap: 2px;
        }

        .separator {
            width: 1.5px;
            height: 18px;
            background: var(--border);
            margin: 0 0.3rem;
        }

        /* ============ Workspace ============ */
        .workspace {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        .pane {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .pane-header {
            background: var(--bg-darker);
            padding: 0.4rem 1rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            font-weight: 800;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .zoom-box {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 6px;
            border-radius: 6px;
        }

        .zoom-val {
            min-width: 38px;
            text-align: center;
            font-family: monospace;
            font-size: 0.75rem;
        }

        #editor-pane {
            width: 50%;
            border-right: 2px solid var(--border);
        }

        .CodeMirror {
            height: 100% !important;
            font-size: 14px;
            font-family: 'Fira Code', 'Consolas', monospace;
            transition: background 0.3s;
        }

        /* Editor color adjustment based on mode */
        body:not(.dark-mode) .CodeMirror {
            background: #ffffff !important;
            color: #000 !important;
        }

        body.dark-mode .CodeMirror {
            background: #010409 !important;
            color: #f8f8f2 !important;
        }

        body.dark-mode .CodeMirror-gutters {
            background: #010409 !important;
            border-right: 1px solid #333;
        }

        body.dark-mode .CodeMirror-linenumber {
            color: #888 !important;
        }

        body.dark-mode .cm-tag {
            color: #f92672 !important;
        }

        body.dark-mode .cm-attribute {
            color: #a6e22e !important;
        }

        body.dark-mode .cm-string {
            color: #e6db74 !important;
        }

        body.dark-mode .cm-atom {
            color: #ae81ff !important;
        }

        body.dark-mode .cm-comment {
            color: #75715e !important;
        }

        body.dark-mode .cm-meta {
            color: #f8f8f2 !important;
        }

        body.dark-mode .cm-qualifier {
            color: #a6e22e !important;
        }

        body.dark-mode .cm-builtin {
            color: #66d9ef !important;
        }

        body.dark-mode .cm-bracket {
            color: #f8f8f2 !important;
        }

        body.dark-mode .cm-keyword {
            color: #f92672 !important;
        }

        .cm-highlight-flash {
            background: rgba(255, 235, 59, 0.4) !important;
            color: #fff !important;
            text-shadow: 0 0 10px #ffeb3b;
        }

        #preview-pane {
            width: 50%;
            background: #f8fafc;
        }

        .preview-content {
            flex: 1;
            overflow: auto;
            display: flex;
            justify-content: center;
            padding: 2.5rem;
            background: #f1f5f9;
        }

        .preview-viewport {
            background: white;
            transform-origin: top center;
            transition: var(--transition);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        iframe#preview-frame {
            width: 100%;
            min-height: 100vh;
            border: none;
            display: block;
        }

        #resizer {
            width: 6px;
            background: var(--border);
            cursor: col-resize;
            transition: background 0.2s;
            z-index: 50;
        }

        #resizer:hover {
            background: var(--primary);
        }

        /* ============ Modals ============ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(12px);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-card {
            background: var(--bg-dark);
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 650px;
            width: 92%;
            border: 1px solid var(--border);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .modal-card h2 {
            font-size: 1.3rem;
            margin-bottom: 1.5rem;
            color: var(--primary);
            padding-right: 30px;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            line-height: 1;
            transition: var(--transition);
        }

        .modal-close:hover {
            color: var(--primary);
            transform: scale(1.1);
        }

        .field {
            margin-bottom: 1rem;
        }

        .field label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 700;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .field input,
        .field select,
        .field textarea {
            width: 100%;
            padding: 0.7rem;
            border: 2px solid var(--border);
            border-radius: 10px;
            background: var(--bg-darker);
            color: var(--text-primary);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .theme-card {
            background: var(--bg-darker);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 0.8rem;
            cursor: pointer;
            text-align: center;
            transition: var(--transition);
        }

        .theme-card.active {
            border-color: var(--primary);
            background: var(--bg-light);
        }

        .color-dot {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            margin-bottom: 6px;
        }

        #toast {
            position: fixed;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%) translateY(120px);
            background: var(--primary);
            color: white;
            padding: 12px 24px;
            border-radius: 100px;
            font-weight: 800;
            transition: transform 0.4s;
            z-index: 9999;
        }

        #toast.show {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>

<body class="light-mode">
    <header class="header">
        <div class="header-top">
            <h1>üé® Blog HTML Editor <span style="font-size:0.75rem; opacity:0.8;">PRO MASTER v2.1</span></h1>
            <div class="main-actions">
                <button class="btn btn-secondary btn-icon" id="dark-toggle" onclick="toggleDarkMode()">‚òÄÔ∏è</button>
                <div class="separator"></div>
                <button class="btn btn-primary" onclick="copyHTML()">üìã Ï†ÑÏ≤¥ Î≥µÏÇ¨</button>
                <button class="btn btn-success" onclick="saveToLocal()">üíæ Ï†ÄÏû•</button>
                <button class="btn btn-danger" onclick="resetEditor()">üîÑ Î¶¨ÏÖã</button>
            </div>
        </div>
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="btn btn-secondary btn-icon" title="Undo" onclick="editor.undo()">‚ü≤</button>
                <button class="btn btn-secondary btn-icon" title="Redo" onclick="editor.redo()">‚ü≥</button>
            </div>
            <div class="separator"></div>
            <button class="btn btn-primary" onclick="openModal('themes')">üåà ÌÖåÎßà Í∞§Îü¨Î¶¨</button>
            <button class="btn btn-secondary" onclick="openModal('toc')">üìë ÏûêÎèô Î™©Ï∞®</button>
            <button class="btn btn-secondary" onclick="openModal('seo')">üîç SEO JSON-LD</button>
            <div class="separator"></div>
            <div class="toolbar-group">
                <button class="btn btn-secondary btn-icon" title="Bold" onclick="wrapSelection('b')"><b>B</b></button>
                <button class="btn btn-secondary btn-icon" title="Underline"
                    onclick="wrapSelection('u')"><u>U</u></button>
                <button class="btn btn-secondary btn-icon" title="Highlight" onclick="insHighlight()"
                    style="color: #f1c40f;">üñçÔ∏è</button>
            </div>
            <div class="separator"></div>
            <div class="toolbar-group">
                <button class="btn btn-secondary" onclick="openModal('h')">H#</button>
                <button class="btn btn-secondary" onclick="openModal('img')">üñºÔ∏è Ïù¥ÎØ∏ÏßÄ</button>
                <button class="btn btn-secondary" onclick="openModal('url')">üîó ÎßÅÌÅ¨</button>
                <button class="btn btn-secondary" onclick="openModal('cta')">üõí Ïø†Ìå°</button>
                <button class="btn btn-secondary" onclick="openModal('br')">‚Ü©Ô∏è BR</button>
                <button class="btn btn-secondary" onclick="insertFairTrade()">‚öñÔ∏è Í≥µÏ†ï</button>
                <button class="btn btn-secondary btn-icon" title="Table" onclick="openModal('tbl')">‚ñ¶</button>
            </div>
        </div>
    </header>

    <main class="workspace">
        <section class="pane" id="editor-pane">
            <div class="pane-header"><span>HTML Code</span>
                <div class="controls">
                    <div class="zoom-box">
                        <button class="btn" style="padding:2px 8px;" onclick="adjustFont(-1)">-</button>
                        <span class="zoom-val" id="font-size-val">14px</span>
                        <button class="btn" style="padding:2px 8px;" onclick="adjustFont(1)">+</button>
                    </div>
                </div>
            </div>
            <textarea id="cm-textarea"></textarea>
        </section>
        <div id="resizer"></div>
        <section class="pane" id="preview-pane">
            <div class="pane-header"><span>Preview</span>
                <div class="controls">
                    <div class="zoom-box">
                        <button class="btn" style="padding:2px 8px;" onclick="adjustScale(-0.1)">-</button>
                        <span class="zoom-val" id="scale-val">100%</span>
                        <button class="btn" style="padding:2px 8px;" onclick="adjustScale(0.1)">+</button>
                    </div>
                    <div class="toolbar-group">
                        <button class="btn btn-secondary btn-icon view-opt active" id="view-100"
                            onclick="setVWidth('100%', '100')">üñ•Ô∏è</button>
                        <button class="btn btn-secondary btn-icon view-opt" id="view-768"
                            onclick="setVWidth('768px', '768')">üì±</button>
                        <button class="btn btn-secondary btn-icon view-opt" id="view-375"
                            onclick="setVWidth('375px', '375')">ü§≥</button>
                    </div>
                </div>
            </div>
            <div class="preview-content">
                <div class="preview-viewport" id="viewport"><iframe id="preview-frame"></iframe></div>
            </div>
        </section>
    </main>

    <div id="toast">Copy Success!</div>

    <!-- Modals -->
    <div class="modal" id="modal-themes">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('themes')">√ó</button>
            <h2>üåà ÌÖåÎßà Í∞§Îü¨Î¶¨</h2>
            <div class="theme-grid" id="theme-grid"></div>
            <div style="margin-top:1.5rem;"><button class="btn btn-secondary" style="width:100%;"
                    onclick="closeModal('themes')">Îã´Í∏∞</button></div>
        </div>
    </div>
    <div class="modal" id="modal-toc">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('toc')">√ó</button>
            <h2>üìë Î™©Ï∞® ÏÉùÏÑ±</h2>
            <div class="field"><label>Ïä§ÌÉÄÏùº</label><select id="toc-style">
                    <option value="box">Modern Box</option>
                    <option value="list">Minimal List</option>
                </select></div><button class="btn btn-primary" style="width:100%;" onclick="generateTOC()">ÏÉùÏÑ± Î∞è
                ÏÇΩÏûÖ</button>
        </div>
    </div>
    <div class="modal" id="modal-seo">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('seo')">√ó</button>
            <h2>üîç JSON-LD</h2>
            <div class="field"><label>ÌÉÄÏûÖ</label><select id="seo-type">
                    <option value="Article">Article</option>
                    <option value="FAQPage">FAQ</option>
                </select></div>
            <div id="seo-p"
                style="background:#000; color:#4ade80; padding:8px; font-size:0.75rem; font-family:monospace; margin-bottom:1rem;">
            </div><button class="btn btn-success" id="seo-btn" onclick="makeJSONLD()">ÏÉùÏÑ±</button><button
                class="btn btn-primary" id="seo-ins" style="display:none;" onclick="insJSONLD()">ÏÇΩÏûÖ</button>
        </div>
    </div>
    <div class="modal" id="modal-h">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('h')">√ó</button>
            <h2>Ï†úÎ™© ÏÇΩÏûÖ</h2>
            <div class="field"><label>Î†àÎ≤®</label><select id="h-lv">
                    <option value="2">H2</option>
                    <option value="3">H3</option>
                </select></div>
            <div class="field"><label>ÎÇ¥Ïö©</label><input type="text" id="h-txt"></div><button class="btn btn-primary"
                style="width:100%;" onclick="insH()">ÏÇΩÏûÖ</button>
        </div>
    </div>
    <div class="modal" id="modal-img">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('img')">√ó</button>
            <h2>Ïù¥ÎØ∏ÏßÄ ÏÇΩÏûÖ</h2>
            <div class="field"><label>URL (ÏõåÎìúÌîÑÎ†àÏä§ ÎØ∏ÎîîÏñ¥ ÎßÅÌÅ¨)</label><input type="text" id="img-url"></div>
            <div class="field"><label>Alt ÏÑ§Î™Ö</label><input type="text" id="img-alt" value="Ïù¥ÎØ∏ÏßÄ"></div>
            <div class="field"
                style="display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
                <input type="checkbox" id="wp-mode" style="width: auto; margin: 0;">
                <label for="wp-mode" style="margin: 0; color: #10b981; font-weight: 800;">ÏõåÎìúÌîÑÎ†àÏä§ Íµ¨ÌÖêÎ≤†Î•¥ÌÅ¨ Ìò∏Ìôò Î™®Îìú</label>
            </div>
            <button class="btn btn-primary" style="width:100%; margin-top: 1rem;" onclick="insImg()">ÏÇΩÏûÖ</button>
        </div>
    </div>
    <div class="modal" id="modal-url">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('url')">√ó</button>
            <h2>ÎßÅÌÅ¨ ÏÇΩÏûÖ</h2>
            <div class="field"><label>ÌÖçÏä§Ìä∏</label><input type="text" id="url-txt" placeholder="ÌëúÏãúÌï† Í∏ÄÏûê"></div>
            <div class="field"><label>Ï£ºÏÜå</label><input type="text" id="url-val" placeholder="https://..."></div>
            <div class="field"><label>ÎßÅÌÅ¨ ÌÉÄÍ≤ü</label><select id="url-target">
                    <option value="_self">ÌòÑÏû¨ Ï∞Ω (_self)</option>
                    <option value="_blank">ÏÉà Ï∞Ω (_blank)</option>
                </select></div>
            <div style="display:flex; gap:10px;"><button class="btn btn-secondary" style="flex:1;"
                    onclick="closeModal('url')">Ï∑®ÏÜå</button><button class="btn btn-primary" style="flex:1;"
                    onclick="insURL()">ÏÇΩÏûÖ</button></div>
        </div>
    </div>
    <div class="modal" id="modal-cta">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('cta')">√ó</button>
            <h2>Ïø†Ìå° Î≤ÑÌäº</h2>
            <div class="field"><label>Î¨∏Íµ¨</label><input type="text" id="cta-txt" value="Ïø†Ìå°ÏóêÏÑú ÌôïÏù∏ÌïòÍ∏∞"></div>
            <div class="field"><label>URL</label><input type="text" id="cta-url"></div>
            <div class="field"><label>ÎßÅÌÅ¨ ÌÉÄÍ≤ü</label><select id="cta-target">
                    <option value="_self">ÌòÑÏû¨ Ï∞Ω (_self)</option>
                    <option value="_blank">ÏÉà Ï∞Ω (_blank)</option>
                </select></div>
            <button class="btn btn-primary" style="width:100%;" onclick="insCTA()">ÏÇΩÏûÖ</button>
        </div>
    </div>
    <div class="modal" id="modal-br">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('br')">√ó</button>
            <h2>Ï§ÑÎ∞îÍøà</h2>
            <div class="field"><label>Í∞úÏàò</label><select id="br-cnt">
                    <option value="2">2Ï§Ñ</option>
                    <option value="1">1Ï§Ñ</option>
                </select></div><button class="btn btn-primary" style="width:100%;" onclick="insBR()">ÏÇΩÏûÖ</button>
        </div>
    </div>
    <div class="modal" id="modal-tbl">
        <div class="modal-card">
            <button class="modal-close" onclick="closeModal('tbl')">√ó</button>
            <h2>ÌÖåÏù¥Î∏î</h2>
            <div style="display:flex; gap:10px;"><input type="number" id="tbl-r" value="3" placeholder="Ìñâ"><input
                    type="number" id="tbl-c" value="2" placeholder="Ïó¥"></div><button class="btn btn-primary"
                style="width:100%; margin-top:1rem;" onclick="insTbl()">ÏÇΩÏûÖ</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>

    <script>
        const THEMES = [
            { n: 'ÏóêÎ©îÎûÑÎìú', h2: '#2ecc71', h3: '#27ae60', m: '#E8F5E9', c: 'linear-gradient(135deg,#ff6f00,#ff8f00)' },
            { n: 'Ïò§ÏÖòÎ∏îÎ£®', h2: '#3498db', h3: '#2980b9', m: '#e3f2fd', c: 'linear-gradient(135deg,#3498db,#2c3e50)' },
            { n: 'ÏÑ†ÏÖãÎ°úÏ¶à', h2: '#e91e63', h3: '#c2185b', m: '#fce4ec', c: 'linear-gradient(135deg,#ff4081,#c2185b)' },
            { n: 'Î°úÏñÑÌçºÌîå', h2: '#9b59b6', h3: '#8e44ad', m: '#f3e5f5', c: 'linear-gradient(135deg,#8e44ad,#34495e)' },
            { n: 'Îî•Ïò§Î†åÏßÄ', h2: '#e67e22', h3: '#d35400', m: '#fff3e0', c: 'linear-gradient(135deg,#e67e22,#2c3e50)' },
            { n: 'Ìè¨Î†àÏä§Ìä∏', h2: '#16a085', h3: '#118d73', m: '#e8f3f1', c: 'linear-gradient(135deg,#16a085,#2c3e50)' },
            { n: 'Í≥®ÎìúÏ≤¥Ïù∏', h2: '#f1c40f', h3: '#f39c12', m: '#fef9e7', c: 'linear-gradient(135deg,#1c1c1c,#f39c12)' },
            { n: 'Ï∞®ÏΩúÎÖ∏ÏïÑ', h2: '#34495e', h3: '#2c3e50', m: '#ebf5fb', c: 'linear-gradient(135deg,#7f8c8d,#2c3e50)' },
            { n: 'ÎÑ§Ïò®ÏÇ¨Ïù¥Î≤Ñ', h2: '#00ffcc', h3: '#00d4aa', m: '#e0fff9', c: 'linear-gradient(135deg,#6600ff,#00ffcc)' },
            { n: 'Ï≤¥Î¶¨ÏÜåÎã§', h2: '#ff4757', h3: '#e84118', m: '#ffecef', c: 'linear-gradient(135deg,#ff4757,#2f3542)' },
            { n: 'ÎùºÎ≤§Îçî', h2: '#a29bfe', h3: '#6c5ce7', m: '#f0efff', c: 'linear-gradient(135deg,#a29bfe,#6c5ce7)' },
            { n: 'ÎØºÌä∏ÌîÑÎ†àÏãú', h2: '#55efc4', h3: '#00b894', m: '#e8fdf8', c: 'linear-gradient(135deg,#55efc4,#00b894)' },
            { n: 'Ïä§Ïπ¥Ïù¥', h2: '#0984e3', h3: '#74b9ff', m: '#e1f5ff', c: 'linear-gradient(135deg,#0984e3,#74b9ff)' },
            { n: 'Î†àÎìúÏôÄÏù∏', h2: '#c0392b', h3: '#96281b', m: '#f9ebea', c: 'linear-gradient(135deg,#c0392b,#2c3e50)' },
            { n: 'Ïä¨Î†àÏù¥Ìä∏', h2: '#95a5a6', h3: '#7f8c8d', m: '#f2f4f4', c: 'linear-gradient(135deg,#95a5a6,#2c3e50)' },
            { n: 'ÎùºÏûÑ', h2: '#badc58', h3: '#6ab04c', m: '#f4f9e9', c: 'linear-gradient(135deg,#badc58,#6ab04c)' },
            { n: 'ÌîºÏπòÌïëÌÅ¨', h2: '#ffbe76', h3: '#f0932b', m: '#fff4e6', c: 'linear-gradient(135deg,#ffbe76,#f0932b)' },
            { n: 'Î≤†Î¶¨ÌéÄÏπò', h2: '#ff7979', h3: '#eb4d4b', m: '#ffeded', c: 'linear-gradient(135deg,#ff7979,#eb4d4b)' },
            { n: 'Ïù∏ÎîîÍ≥†', h2: '#4834d4', h3: '#686de0', m: '#ededff', c: 'linear-gradient(135deg,#4834d4,#686de0)' },
            { n: 'ÏãúÏïàÌÖåÏùº', h2: '#22a6b3', h3: '#7ed6df', m: '#e0faff', c: 'linear-gradient(135deg,#22a6b3,#7ed6df)' }
        ];

        let state = {
            font: parseInt(localStorage.getItem('f')) || 14,
            scale: parseFloat(localStorage.getItem('s')) || 1.0,
            dark: localStorage.getItem('d') === 'true',
            v: localStorage.getItem('v') || '100',
            t: parseInt(localStorage.getItem('t')) || 0,
            jsonld: ''
        };

        const editor = CodeMirror.fromTextArea(document.getElementById('cm-textarea'), {
            mode: 'htmlmixed', theme: 'monokai', lineNumbers: true, lineWrapping: true,
            indentUnit: 2, tabSize: 2, matchBrackets: true, extraKeys: { "Ctrl-Z": "undo", "Ctrl-Y": "redo" }
        });

        function init() {
            editor.setValue(localStorage.getItem('c') || getDefault());
            apply(); renderThemes(); setupRes();
            editor.on('change', () => { clearTimeout(this.tid); this.tid = setTimeout(() => { render(); localStorage.setItem('c', editor.getValue()); }, 400); });
            render();
        }

        function apply() {
            document.body.classList.toggle('dark-mode', state.dark);
            document.getElementById('dark-toggle').textContent = state.dark ? '‚òÄÔ∏è' : 'üåô';
            editor.setOption('theme', state.dark ? 'monokai' : 'default');
            document.querySelector('.CodeMirror').style.fontSize = state.font + 'px';
            document.getElementById('font-size-val').textContent = state.font + 'px';
            document.getElementById('viewport').style.transform = `scale(${state.scale})`;
            document.getElementById('scale-val').textContent = Math.round(state.scale * 100) + '%';
            setVWidth(state.v === '100' ? '100%' : state.v + 'px', state.v);
        }

        function toggleDarkMode() { state.dark = !state.dark; localStorage.setItem('d', state.dark); apply(); render(); }
        function adjustFont(d) { state.font = Math.min(24, Math.max(12, state.font + d)); localStorage.setItem('f', state.font); apply(); }
        function adjustScale(d) { state.scale = Math.min(2, Math.max(0.5, state.scale + d)); localStorage.setItem('s', state.scale); apply(); }
        function setVWidth(w, m) { state.v = m; localStorage.setItem('v', m); document.getElementById('viewport').style.width = w; document.querySelectorAll('.view-opt').forEach(b => b.classList.toggle('active', b.id === 'view-' + m)); }

        function render() {
            const doc = document.getElementById('preview-frame').contentDocument;
            const code = editor.getValue();
            const t = THEMES[state.t];
            const css = `<style>
                body { font-family: 'Segoe UI', sans-serif; line-height: 1.8; color: #333; margin: 0; padding: 20px; }
                .wrap { max-width: 800px; margin: 0 auto; }
                br { display: block; margin: 15px 0; content: ""; }
                img { max-width: 100%; width: 100%; height: auto; border-radius: 12px; display: block; margin: 25px auto; box-shadow: 0 4px 20px rgba(0,0,0,0.1); cursor: pointer; }
                h2 { color: ${t.h2}; border-bottom: 3px solid ${t.h2}; padding-bottom: 10px; margin: 55px 0 25px 0; font-size: 1.6rem; }
                h3 { color: ${t.h3}; margin: 35px 0 15px 0; font-size: 1.3rem; border-left: 5px solid ${t.h3}; padding-left: 10px; }
                a { color: ${t.h2}; text-decoration: none; font-weight: 600; }
                .meta-box { background: ${t.m}; padding: 25px; border-radius: 10px; margin-bottom: 35px; border: 1px solid #ddd; }
                .cta-btn { display: inline-flex; align-items: center; justify-content: center; width: 100%; max-width: 600px; background: ${t.c}; color: #fff !important; padding: 18px; border-radius: 40px; font-weight: 800; font-size: 18px; text-decoration: none !important; box-shadow: 0 10px 20px rgba(0,0,0,0.15); transition: 0.3s; margin: 20px auto; }
                .cta-btn:hover { transform: translateY(-5px); filter: brightness(1.1); }
                ${state.dark ? 'body{background:#1e1e1e;color:#ddd;}.meta-box{background:#2a2a2a;border-color:#444;}' : ''}
            </style>`;
            doc.open(); doc.write(`${css}<body><div class="wrap">${code}</div></body>`); doc.close();
            doc.body.onclick = (e) => {
                if (e.target === doc.body || e.target.classList.contains('wrap')) { openModal('img'); return; }
                const txt = e.target.innerText?.trim().slice(0, 20) || e.target.src;
                if (!txt) return;
                const cur = editor.getSearchCursor(txt, { line: 0, ch: 0 });
                if (cur.findNext()) { editor.setSelection(cur.from(), cur.to()); editor.scrollIntoView(cur.from(), 250); editor.focus(); }
            };
        }

        function renderThemes() {
            const g = document.getElementById('theme-grid'); g.innerHTML = '';
            THEMES.forEach((t, i) => {
                const c = document.createElement('div'); c.className = 'theme-card' + (i === state.t ? ' active' : '');
                c.innerHTML = `<div class="color-dot" style="background:${t.h2}"></div><div style="font-size:0.7rem;font-weight:800;">${t.n}</div>`;
                c.onclick = () => { state.t = i; localStorage.setItem('t', i); renderThemes(); render(); };
                g.appendChild(c);
            });
        }

        function openModal(id) { document.getElementById('modal-' + id).classList.add('active'); }
        function closeModal(id) { document.getElementById('modal-' + id).classList.remove('active'); }

        // Close modal on background click or ESC key
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.classList.remove('active');
            }
        });
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(m => m.classList.remove('active'));
            }
        });

        function wrapSelection(tag) {
            const selection = editor.getSelection();
            editor.replaceSelection(`<${tag}>${selection}</${tag}>`);
            if (!selection) {
                const cur = editor.getCursor();
                editor.setCursor(cur.line, cur.ch - (tag.length + 3));
            }
            editor.focus();
        }

        function insHighlight() {
            const selection = editor.getSelection();
            const open = '<span style="background-color:#fff3cd; padding:2px 6px; border-radius:6px;"><b>';
            const close = '</b></span>';
            editor.replaceSelection(open + selection + close);
            if (!selection) {
                const cur = editor.getCursor();
                editor.setCursor(cur.line, cur.ch - close.length);
            }
            editor.focus();
        }

        function insAt(t) { editor.replaceRange(t + '\n', editor.getCursor()); editor.focus(); }
        function insH() { insAt(`<h${document.getElementById('h-lv').value}>${document.getElementById('h-txt').value}</h${document.getElementById('h-lv').value}>`); closeModal('h'); }
        function insImg() {
            const url = document.getElementById('img-url').value;
            const alt = document.getElementById('img-alt').value;
            const isWP = document.getElementById('wp-mode').checked;
            let html = "";
            if (isWP) {
                html = `<figure class="wp-block-image size-full"><img src="${url}" alt="${alt}" class="wp-image-0" style="width: 100%; height: auto; border-radius: 12px;"/></figure>`;
            } else {
                html = `<img src="${url}" alt="${alt}">`;
            }
            insAt(html);
            closeModal('img');
        }
        function insCTA() {
            const url = document.getElementById('cta-url').value;
            const txt = document.getElementById('cta-txt').value;
            const target = document.getElementById('cta-target').value;
            insAt(`\n<div style="text-align:center; margin:40px 0;">\n  <a href="${url}" target="${target}" class="cta-btn">üõí ${txt} ‚Ä∫</a>\n</div>`);
            closeModal('cta');
        }
        function insBR() { insAt('<br>'.repeat(document.getElementById('br-cnt').value)); closeModal('br'); }
        function insTbl() {
            let h = '<table><thead><tr>';
            for (let j = 0; j < document.getElementById('tbl-c').value; j++) h += '<th>Ï†úÎ™©</th>';
            h += '</tr></thead><tbody>';
            for (let i = 0; i < document.getElementById('tbl-r').value; i++) { h += '<tr>'; for (let j = 0; j < document.getElementById('tbl-c').value; j++)h += '<td>ÎÇ¥Ïö©</td>'; h += '</tr>'; }
            h += '</tbody></table>'; insAt(h); closeModal('tbl');
        }
        function insURL() {
            const url = document.getElementById('url-val').
