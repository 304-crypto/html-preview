<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ë¸”ë¡œê·¸ HTML ì—ë””í„° Pro Master â˜…â˜…â˜…â˜…â˜…</title>
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Libraries (CDN Only) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/monokai.min.css" />
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/matchesonscrollbar.css" />

  <style>
    /* ============ Professional UI Design System ============ */
    :root {
      --primary: #6366f1;
      --primary-glow: rgba(99, 102, 241, 0.4);
      --bg-dark: #0f172a;
      --bg-darker: #020617;
      --bg-light: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #cbd5e1;
      --border: #334155;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body.dark-mode {
      --bg-dark: #000000;
      --bg-darker: #111111;
      --bg-light: #222222;
      --border: #444444;
    }

    body {
      font-family: 'Inter', 'Segoe UI', 'Malgun Gothic', system-ui, sans-serif;
      background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
      color: var(--text-primary);
      height: 100vh;
      margin: 0;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* ============ Header & Toolbar ============ */
    .header {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(15px);
      border-bottom: 2px solid var(--primary);
      padding: 0.6rem 1.25rem;
      z-index: 100;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3);
    }

    .header-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.6rem;
    }

    .header h1 {
      font-size: 1.1rem;
      font-weight: 800;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #818cf8, #c084fc, #f472b6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .btn {
      padding: 0.4rem 0.75rem;
      border: none;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      user-select: none;
    }

    .btn:hover:not(:disabled) {
      transform: translateY(-1.5px);
      filter: brightness(1.1);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-success {
      background: #10b981;
      color: white;
    }

    .btn-danger {
      background: #ef4444;
      color: white;
    }

    .btn-secondary {
      background: var(--bg-light);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-icon {
      padding: 0.4rem;
      min-width: 34px;
      justify-content: center;
      font-size: 1.1rem;
    }

    .toolbar-group {
      display: flex;
      background: rgba(255, 255, 255, 0.06);
      padding: 2px;
      border-radius: 10px;
      gap: 2px;
    }

    .separator {
      width: 1.5px;
      height: 18px;
      background: var(--border);
      margin: 0 0.3rem;
    }

    /* ============ Workspace ============ */
    .workspace {
      flex: 1;
      display: flex;
      overflow: hidden;
      position: relative;
    }

    .pane {
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .pane-header {
      background: var(--bg-darker);
      padding: 0.4rem 1rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.7rem;
      font-weight: 800;
      color: var(--text-secondary);
      text-transform: uppercase;
    }

    .zoom-box {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      background: rgba(0, 0, 0, 0.3);
      padding: 2px 6px;
      border-radius: 6px;
    }

    .zoom-val {
      min-width: 38px;
      text-align: center;
      font-family: monospace;
      font-size: 0.75rem;
    }

    #editor-pane {
      width: 50%;
      border-right: 2px solid var(--border);
    }

    .CodeMirror {
      height: 100% !important;
      font-size: 14px;
      font-family: 'Fira Code', 'Consolas', monospace;
      transition: background 0.3s;
    }

    body:not(.dark-mode) .CodeMirror {
      background: #ffffff !important;
      color: #000 !important;
    }

    body.dark-mode .CodeMirror {
      background: #0d1117 !important;
      color: #c9d1d9 !important;
    }

    body.dark-mode .CodeMirror-gutters {
      background: #0d1117 !important;
      border-right: 1px solid #30363d;
    }

    body.dark-mode .CodeMirror-linenumber {
      color: #8b949e !important;
    }

    body.dark-mode .cm-tag {
      color: #7ee787 !important;
    }

    body.dark-mode .cm-attribute {
      color: #d2a8ff !important;
    }

    body.dark-mode .cm-string {
      color: #a5d6ff !important;
    }

    body.dark-mode .cm-atom {
      color: #ff7b72 !important;
    }

    body.dark-mode .cm-keyword {
      color: #ff7b72 !important;
    }

    body.dark-mode .cm-comment {
      color: #8b949e !important;
    }

    body.dark-mode .cm-meta {
      color: #f1f5f9 !important;
    }

    body.dark-mode .cm-bracket {
      color: #c9d1d9 !important;
    }

    .cm-highlight-flash {
      background: rgba(255, 235, 59, 0.4) !important;
      color: #fff !important;
      text-shadow: 0 0 10px #ffeb3b;
    }

    #preview-pane {
      width: 50%;
      background: #f8fafc;
    }

    .preview-content {
      flex: 1;
      overflow: auto;
      padding: 2.5rem;
      background: #f1f5f9;
      height: auto;
      position: relative;
    }

    .preview-viewport {
      background: white;
      transform-origin: top center;
      transition: transform 0.3s;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.12);
      border-radius: 4px;
      overflow: hidden;
      position: relative;
      height: auto;
      min-height: 100%;
    }

    iframe#preview-frame {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      overflow: hidden;
    }

    #resizer {
      width: 6px;
      background: var(--border);
      cursor: col-resize;
      transition: background 0.2s;
      z-index: 50;
    }

    #resizer:hover {
      background: var(--primary);
    }

    /* ============ Modals & Theme Grid ============ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(12px);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-card {
      background: var(--bg-dark);
      border-radius: 20px;
      padding: 2.5rem;
      max-width: 650px;
      width: 92%;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--border);
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
      position: relative;
    }

    .modal-card::-webkit-scrollbar {
      width: 8px;
    }

    .modal-card::-webkit-scrollbar-track {
      background: var(--bg-darker);
      border-radius: 10px;
    }

    .modal-card::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    .modal-card h2 {
      font-size: 1.3rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
      padding-right: 30px;
    }

    .modal-close {
      position: absolute;
      top: 1.5rem;
      right: 1.5rem;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5rem;
      cursor: pointer;
      line-height: 1;
      transition: var(--transition);
    }

    .modal-close:hover {
      color: var(--primary);
      transform: scale(1.1);
    }

    .field {
      margin-bottom: 1rem;
    }

    .field label {
      display: block;
      margin-bottom: 0.4rem;
      font-weight: 700;
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .field input,
    .field select,
    .field textarea {
      width: 100%;
      padding: 0.7rem;
      border: 2px solid var(--border);
      border-radius: 10px;
      background: var(--bg-darker);
      color: var(--text-primary);
    }

    .color-dot {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .color-dot:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 10px;
      max-height: 400px;
      overflow-y: auto;
    }

    .theme-card {
      background: var(--bg-darker);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 0.8rem;
      cursor: pointer;
      text-align: center;
      transition: var(--transition);
    }

    .theme-card.active {
      border-color: var(--primary);
      background: var(--bg-light);
    }

    .theme-card .color-dot {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      margin-bottom: 6px;
    }

    #toast {
      position: fixed;
      bottom: 35px;
      left: 50%;
      transform: translateX(-50%) translateY(120px);
      background: var(--primary);
      color: white;
      padding: 12px 24px;
      border-radius: 100px;
      font-weight: 800;
      transition: transform 0.4s;
      z-index: 9999;
    }

    #toast.show {
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>

<body class="light-mode">
  <header class="header">
    <div class="header-top">
      <h1>ğŸ¨ Blog HTML Editor <span style="font-size:0.75rem; opacity:0.8;">PRO MASTER v2.3</span></h1>
      <div class="main-actions">
        <button class="btn btn-secondary btn-icon" id="dark-toggle" onclick="toggleDarkMode()">â˜€ï¸</button>
        <div class="separator"></div>
        <button class="btn btn-primary" onclick="copyHTML()">ğŸ“‹ ì „ì²´ ë³µì‚¬</button>
        <button class="btn btn-success" onclick="saveToLocal()">ğŸ’¾ ì €ì¥</button>
        <button class="btn btn-danger" onclick="resetEditor()">ğŸ”„ ë¦¬ì…‹</button>
        <button class="btn btn-danger" style="background:#dc2626;" onclick="clearCache()">ğŸ§¹ ìºì‹œ ì‚­ì œ</button>
      </div>
    </div>

    <div class="toolbar">
      <div class="toolbar-group">
        <button class="btn btn-secondary btn-icon" title="Undo" onclick="editor.undo()">âŸ²</button>
        <button class="btn btn-secondary btn-icon" title="Redo" onclick="editor.redo()">âŸ³</button>
      </div>

      <div class="separator"></div>

      <button class="btn btn-primary" onclick="openModal('themes')">ğŸŒˆ í…Œë§ˆ ê°¤ëŸ¬ë¦¬</button>

      <!-- âœ… ì¶”ê°€ëœ ë²„íŠ¼: í…Œë§ˆë¥¼ ì½”ë“œì— ì ìš©/ë˜ëŒë¦¬ê¸° -->
      <button class="btn btn-success" onclick="applyThemeInline()">ğŸ¨ í…Œë§ˆë¥¼ ì½”ë“œì— ì ìš©</button>
      <button class="btn btn-secondary" onclick="restoreBeforeTheme()">â†©ï¸ ì ìš© ì „ìœ¼ë¡œ ë˜ëŒë¦¬ê¸°</button>

      <button class="btn btn-secondary" onclick="openModal('toc')">ğŸ“‘ ìë™ ëª©ì°¨</button>
      <button class="btn btn-secondary" onclick="openModal('seo')">ğŸ” SEO JSON-LD</button>

      <div class="separator"></div>

      <div class="toolbar-group">
        <button class="btn btn-secondary btn-icon" title="Bold" onclick="wrapSelection('b')"><b>B</b></button>
        <button class="btn btn-secondary btn-icon" title="Underline" onclick="wrapSelection('u')"><u>U</u></button>
        <button class="btn btn-secondary btn-icon" title="Highlight" onclick="insHighlight()" style="color: #f1c40f;">ğŸ–ï¸</button>
      </div>

      <div class="separator"></div>

      <div class="toolbar-group">
        <button class="btn btn-secondary" onclick="openModal('h')">H#</button>
        <button class="btn btn-secondary" onclick="openModal('img')">ğŸ–¼ï¸ ì´ë¯¸ì§€</button>
        <button class="btn btn-secondary" onclick="openModal('url')">ğŸ”— ë§í¬</button>
        <button class="btn btn-secondary" onclick="openModal('cta')">âœ¨ ë²„íŠ¼</button>
        <button class="btn btn-secondary" onclick="openModal('app')">ğŸ“± ì•±</button>
        <button class="btn btn-secondary" onclick="insBRQuick()">â†©ï¸ BR</button>
        <button class="btn btn-secondary" onclick="insertFairTrade()">âš–ï¸ ê³µì •</button>
        <button class="btn btn-secondary btn-icon" title="Table" onclick="openModal('tbl')">â–¦</button>
      </div>
    </div>
  </header>

  <main class="workspace">
    <section class="pane" id="editor-pane">
      <div class="pane-header">
        <span>HTML Code</span>
        <div class="controls">
          <div class="zoom-box">
            <button class="btn" style="padding:2px 8px;" onclick="adjustFont(-1)">-</button>
            <span class="zoom-val" id="font-size-val">14px</span>
            <button class="btn" style="padding:2px 8px;" onclick="adjustFont(1)">+</button>
          </div>
        </div>
      </div>
      <textarea id="cm-textarea"></textarea>
    </section>

    <div id="resizer"></div>

    <section class="pane" id="preview-pane">
      <div class="pane-header">
        <span>Preview</span>
        <div class="controls">
          <div class="zoom-box">
            <button class="btn" style="padding:2px 8px;" onclick="adjustScale(-0.1)">-</button>
            <span class="zoom-val" id="scale-val">100%</span>
            <button class="btn" style="padding:2px 8px;" onclick="adjustScale(0.1)">+</button>
          </div>

          <div class="toolbar-group">
            <button class="btn btn-secondary btn-icon view-opt active" id="view-100" onclick="setVWidth('100%', '100')">ğŸ–¥ï¸</button>
            <button class="btn btn-secondary btn-icon view-opt" id="view-768" onclick="setVWidth('768px', '768')">ğŸ“±</button>
            <button class="btn btn-secondary btn-icon view-opt" id="view-375" onclick="setVWidth('375px', '375')">ğŸ¤³</button>
            <button class="btn btn-secondary btn-icon" id="preview-click-toggle" title="ë¯¸ë¦¬ë³´ê¸° í´ë¦­ ëª¨ë“œ" onclick="togglePreviewClickMode()">ğŸ”’</button>
          </div>
        </div>
      </div>

      <div class="preview-content">
        <div class="preview-viewport" id="viewport">
          <iframe id="preview-frame"></iframe>
        </div>
      </div>
    </section>
  </main>

  <div id="toast">Copy Success!</div>

  <!-- í…Œë§ˆ ê°¤ëŸ¬ë¦¬ ëª¨ë‹¬ -->
  <div class="modal" id="modal-themes">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('themes')">Ã—</button>
      <h2>ğŸŒˆ í…Œë§ˆ ê°¤ëŸ¬ë¦¬</h2>
      <div class="theme-grid" id="theme-grid"></div>
      <div style="margin-top:1.5rem;">
        <button class="btn btn-secondary" style="width:100%;" onclick="closeModal('themes')">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ëª©ì°¨ ëª¨ë‹¬ -->
  <div class="modal" id="modal-toc">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('toc')">Ã—</button>
      <h2>ğŸ“‘ ëª©ì°¨ ìƒì„±</h2>
      <div class="field">
        <label>ìŠ¤íƒ€ì¼</label>
        <select id="toc-style">
          <option value="box">Modern Box</option>
          <option value="list">Minimal List</option>
        </select>
      </div>
      <button class="btn btn-primary" style="width:100%;" onclick="generateTOC()">ìƒì„± ë° ì‚½ì…</button>
    </div>
  </div>

  <!-- SEO JSON-LD ëª¨ë‹¬ -->
  <div class="modal" id="modal-seo">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('seo')">Ã—</button>
      <h2>ğŸ” JSON-LD</h2>
      <div class="field">
        <label>íƒ€ì…</label>
        <select id="seo-type">
          <option value="Article">Article</option>
          <option value="FAQPage">FAQ</option>
        </select>
      </div>
      <div id="seo-p" style="background:#000; color:#4ade80; padding:8px; font-size:0.75rem; font-family:monospace; margin-bottom:1rem;"></div>
      <button class="btn btn-success" id="seo-btn" onclick="makeJSONLD()">ìƒì„±</button>
      <button class="btn btn-primary" id="seo-ins" style="display:none;" onclick="insJSONLD()">ì‚½ì…</button>
    </div>
  </div>

  <!-- ì œëª© ëª¨ë‹¬ -->
  <div class="modal" id="modal-h">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('h')">Ã—</button>
      <h2>ì œëª© ì‚½ì…</h2>
      <div class="field">
        <label>ë ˆë²¨</label>
        <select id="h-lv">
          <option value="2">H2</option>
          <option value="3">H3</option>
        </select>
      </div>
      <div class="field">
        <label>ë‚´ìš©</label>
        <input type="text" id="h-txt" />
      </div>
      <button class="btn btn-primary" style="width:100%;" onclick="insH()">ì‚½ì…</button>
    </div>
  </div>

  <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
  <div class="modal" id="modal-img">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('img')">Ã—</button>
      <h2>ì´ë¯¸ì§€ ì‚½ì…</h2>

      <div class="field">
        <label>ì´ë¯¸ì§€ íƒ€ì…</label>
        <select id="img-type" onchange="toggleImgLinkField()">
          <option value="normal">ì¼ë°˜ ì´ë¯¸ì§€</option>
          <option value="linked">ë§í¬ê°€ ìˆëŠ” ì´ë¯¸ì§€</option>
        </select>
      </div>

      <div class="field">
        <label>ì´ë¯¸ì§€ URL (ì›Œë“œí”„ë ˆìŠ¤ ë¯¸ë””ì–´ ë§í¬)</label>
        <input type="text" id="img-url" />
      </div>

      <div class="field">
        <label>Alt ì„¤ëª…</label>
        <input type="text" id="img-alt" value="ì´ë¯¸ì§€" />
      </div>

      <div class="field" id="img-link-field" style="display: none;">
        <label>ë§í¬ URL (ì´ë¯¸ì§€ í´ë¦­ ì‹œ ì´ë™í•  ì£¼ì†Œ)</label>
        <input type="text" id="img-link-url" placeholder="https://..." />
      </div>

      <!-- âœ… target ì„ íƒ ìì²´ë¥¼ ì œê±°(ìƒˆì°½ ê¸ˆì§€ ë£°) -->
      <div class="field" id="img-link-target-field" style="display: none;">
        <label>ë§í¬ íƒ€ê²Ÿ</label>
        <select id="img-link-target" disabled>
          <option value="_self">í˜„ì¬ ì°½ (_self)</option>
        </select>
      </div>

      <div class="field">
        <label>ì´ë¯¸ì§€ í¬ê¸°</label>
        <select id="img-size-preset" onchange="updateImgSizeSlider()">
          <option value="100">ì „ì²´ ë„ˆë¹„ (100%)</option>
          <option value="80">í¬ê²Œ (80%)</option>
          <option value="60">ì¤‘ê°„ (60%)</option>
          <option value="40">ì‘ê²Œ (40%)</option>
          <option value="custom">ì‚¬ìš©ì ì •ì˜</option>
        </select>
      </div>

      <div class="field" id="img-size-slider-field" style="display: none;">
        <label>ì‚¬ìš©ì ì •ì˜ í¬ê¸°</label>
        <input type="range" id="img-size-slider" min="20" max="100" value="100" step="5" />
        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary); margin-top: 5px;">
          <span>20%</span>
          <span id="img-size-value" style="background: var(--primary); color: white; padding: 2px 8px; border-radius: 4px; font-weight: 500;">100%</span>
          <span>100%</span>
        </div>
      </div>

      <div class="field" style="display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px;">
        <input type="checkbox" id="wp-mode" style="width: auto; margin: 0;" />
        <label for="wp-mode" style="margin: 0; color: #10b981; font-weight: 800;">ì›Œë“œí”„ë ˆìŠ¤ êµ¬í…ë² ë¥´í¬ í˜¸í™˜ ëª¨ë“œ</label>
      </div>

      <button class="btn btn-primary" style="width:100%; margin-top: 1rem;" onclick="insImg()">ì‚½ì…</button>
    </div>
  </div>

  <!-- ë§í¬ ëª¨ë‹¬ -->
  <div class="modal" id="modal-url">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('url')">Ã—</button>
      <h2>ë§í¬ ì‚½ì…</h2>
      <div class="field">
        <label>í…ìŠ¤íŠ¸</label>
        <input type="text" id="url-txt" placeholder="í‘œì‹œí•  ê¸€ì" />
      </div>
      <div class="field">
        <label>ì£¼ì†Œ</label>
        <input type="text" id="url-val" placeholder="https://..." />
      </div>

      <!-- âœ… target ì„ íƒ ì œê±°(ìƒˆì°½ ê¸ˆì§€ ë£°) -->
      <div class="field">
        <label>ë§í¬ íƒ€ê²Ÿ</label>
        <select id="url-target" disabled>
          <option value="_self">í˜„ì¬ ì°½ (_self)</option>
        </select>
      </div>

      <div style="display:flex; gap:10px;">
        <button class="btn btn-secondary" style="flex:1;" onclick="closeModal('url')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" style="flex:1;" onclick="insURL()">ì‚½ì…</button>
      </div>
    </div>
  </div>

  <!-- CTA ë²„íŠ¼ ëª¨ë‹¬ -->
  <div class="modal" id="modal-cta">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('cta')">Ã—</button>
      <h2>âœ¨ ë°˜ì§ì´ëŠ” ë²„íŠ¼ ìƒì„±ê¸°</h2>

      <div class="field">
        <label>ë²„íŠ¼ í…ìŠ¤íŠ¸</label>
        <input type="text" id="cta-txt" value="ë²„íŠ¼ í´ë¦­í•˜ê¸° ğŸ‘‰" />
      </div>

      <div class="field">
        <label>ë§í¬ URL</label>
        <input type="url" id="cta-url" placeholder="https://example.com" />
      </div>

      <!-- âœ… target ì„ íƒ ì œê±°(ìƒˆì°½ ê¸ˆì§€ ë£°) -->
      <div class="field">
        <label>ë§í¬ íƒ€ê²Ÿ</label>
        <select id="cta-target" disabled>
          <option value="_self">í˜„ì¬ ì°½ (_self)</option>
        </select>
      </div>

      <div class="field">
        <label>ë°°ê²½ ìƒ‰ìƒ</label>
        <input type="text" id="cta-bg-color" value="#00FFEF" placeholder="#00FFEF" maxlength="7" />
        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; margin-top: 8px;">
          <div class="color-dot" data-color="#FF00FF" style="background: #FF00FF;" title="ë§ˆì  íƒ€"></div>
          <div class="color-dot" data-color="#00FFEF" style="background: #00FFEF;" title="í‹±í†¡ ë¸”ë£¨"></div>
          <div class="color-dot" data-color="#FFF700" style="background: #FFF700;" title="ë„¤ì˜¨ ì˜ë¡œìš°"></div>
          <div class="color-dot" data-color="#39FF14" style="background: #39FF14;" title="ë„¤ì˜¨ ê·¸ë¦°"></div>
          <div class="color-dot" data-color="#FF3CAC" style="background: #FF3CAC;" title="í•‘í¬"></div>
          <div class="color-dot" data-color="#FF7F50" style="background: #FF7F50;" title="ì½”ë„"></div>
        </div>
      </div>

      <div class="field">
        <label>í…ìŠ¤íŠ¸ ìƒ‰ìƒ</label>
        <input type="text" id="cta-text-color" value="#000000" placeholder="#000000" maxlength="7" />
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; margin-top: 8px;">
          <div class="color-dot" data-color="#000000" style="background: #000000;" title="ê²€ì •"></div>
          <div class="color-dot" data-color="#FFFFFF" style="background: #FFFFFF; border: 1px solid #ccc;" title="í°ìƒ‰"></div>
          <div class="color-dot" data-color="#333333" style="background: #333333;" title="ë‹¤í¬ ê·¸ë ˆì´"></div>
          <div class="color-dot" data-color="#666666" style="background: #666666;" title="ê·¸ë ˆì´"></div>
        </div>
      </div>

      <div class="field">
        <label>ë²„íŠ¼ ë„ˆë¹„</label>
        <select id="cta-width">
          <option value="100%">ì „ì²´ ë„ˆë¹„ (100%)</option>
          <option value="auto">ìë™ í¬ê¸°</option>
          <option value="300px">ê³ ì • (300px)</option>
        </select>
      </div>

      <div class="field">
        <label>í°íŠ¸ í¬ê¸°</label>
        <input type="range" id="cta-font-size" min="14" max="28" value="20" />
        <div style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-secondary);">
          <span>ì‘ê²Œ</span>
          <span id="cta-font-size-value">20px</span>
          <span>í¬ê²Œ</span>
        </div>
      </div>

      <div class="field">
        <label>ë²„íŠ¼ ìŠ¤íƒ€ì¼</label>
        <div style="display: flex; flex-direction: column; gap: 8px;">
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="cta-shiny" checked />
            <span>âœ¨ ë°˜ì§ì´ëŠ” íš¨ê³¼</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="cta-float" checked />
            <span>ğŸˆ ë– ë‹¤ë‹ˆëŠ” ì• ë‹ˆë©”ì´ì…˜</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="cta-shadow" checked />
            <span>ğŸŒŸ ê·¸ë¦¼ì íš¨ê³¼</span>
          </label>
          <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="cta-gradient" />
            <span>ğŸŒˆ ê·¸ë¼ë°ì´ì…˜ ë°°ê²½</span>
          </label>
        </div>
      </div>

      <div class="field">
        <label>í˜¸ë²„ íš¨ê³¼</label>
        <select id="cta-hover">
          <option value="opacity">íˆ¬ëª…ë„ ë³€í™”</option>
          <option value="scale">í¬ê¸° ë³€í™”</option>
          <option value="pulse">í„ìŠ¤</option>
        </select>
      </div>

      <div style="background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); border-radius: 12px; padding: 20px; margin: 15px 0; display: flex; justify-content: center; align-items: center; min-height: 80px;">
        <div id="cta-preview" style="display: inline-flex;"></div>
      </div>

      <button class="btn btn-primary" style="width:100%;" onclick="insCTA()">ì‚½ì…</button>
    </div>
  </div>


  <!-- ì•± ë‹¤ìš´ë¡œë“œ ë¸”ë¡ ëª¨ë‹¬ -->
  <div class="modal" id="modal-app">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('app')">Ã—</button>
      <h2>ğŸ“± ì•± ë‹¤ìš´ë¡œë“œ ë¸”ë¡</h2>

      <div class="field">
        <label>ì•± ì´ë¦„</label>
        <input type="text" id="app-name" placeholder="ì˜ˆ) í† ìŠ¤, ë„¤ì´ë²„í˜ì´" />
      </div>

      <div class="field">
        <label>ì•„ì´ì½˜ URL (ì‘ì€ ì•„ì´ì½˜ 1ê°œ)</label>
        <input type="text" id="app-icon" placeholder="https://... (png/webp ì¶”ì²œ)" />
      </div>

      <div class="field">
        <label>Google Play ë§í¬ (ì—†ìœ¼ë©´ ë¹„ì›Œë‘ê¸°)</label>
        <input type="text" id="app-google" placeholder="https://play.google.com/store/apps/details?id=..." />
      </div>

      <div class="field">
        <label>App Store ë§í¬ (ì—†ìœ¼ë©´ ë¹„ì›Œë‘ê¸°)</label>
        <input type="text" id="app-apple" placeholder="https://apps.apple.com/..." />
      </div>

      <button class="btn btn-primary" style="width:100%;" onclick="insAppBlock()">ì‚½ì…</button>
    </div>
  </div>


  <!-- í…Œì´ë¸” ëª¨ë‹¬ -->
  <div class="modal" id="modal-tbl">
    <div class="modal-card">
      <button class="modal-close" onclick="closeModal('tbl')">Ã—</button>
      <h2>í…Œì´ë¸”</h2>
      <div style="display:flex; gap:10px;">
        <input type="number" id="tbl-r" value="3" placeholder="í–‰" />
        <input type="number" id="tbl-c" value="2" placeholder="ì—´" />
      </div>
      <button class="btn btn-primary" style="width:100%; margin-top:1rem;" onclick="insTbl()">ì‚½ì…</button>
    </div>
  </div>

  <!-- CodeMirror -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/xml/xml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/addon/search/searchcursor.min.js"></script>

  <script>
    const THEMES = [
      { n: 'ì—ë©”ë„ë“œ', h2: '#2ecc71', h3: '#27ae60', m: '#E8F5E9', c: 'linear-gradient(135deg,#ff6f00,#ff8f00)' },
      { n: 'ì˜¤ì…˜ë¸”ë£¨', h2: '#3498db', h3: '#2980b9', m: '#e3f2fd', c: 'linear-gradient(135deg,#3498db,#2c3e50)' },
      { n: 'ì„ ì…‹ë¡œì¦ˆ', h2: '#e91e63', h3: '#c2185b', m: '#fce4ec', c: 'linear-gradient(135deg,#ff4081,#c2185b)' },
      { n: 'ë¡œì–„í¼í”Œ', h2: '#9b59b6', h3: '#8e44ad', m: '#f3e5f5', c: 'linear-gradient(135deg,#8e44ad,#34495e)' },
      { n: 'ë”¥ì˜¤ë Œì§€', h2: '#e67e22', h3: '#d35400', m: '#fff3e0', c: 'linear-gradient(135deg,#e67e22,#2c3e50)' },
      { n: 'í¬ë ˆìŠ¤íŠ¸', h2: '#16a085', h3: '#118d73', m: '#e8f3f1', c: 'linear-gradient(135deg,#16a085,#2c3e50)' },
      { n: 'ê³¨ë“œì²´ì¸', h2: '#f1c40f', h3: '#f39c12', m: '#fef9e7', c: 'linear-gradient(135deg,#1c1c1c,#f39c12)' },
      { n: 'ì°¨ì½œë…¸ì•„', h2: '#34495e', h3: '#2c3e50', m: '#ebf5fb', c: 'linear-gradient(135deg,#7f8c8d,#2c3e50)' },
      { n: 'ë„¤ì˜¨ì‚¬ì´ë²„', h2: '#00ffcc', h3: '#00d4aa', m: '#e0fff9', c: 'linear-gradient(135deg,#6600ff,#00ffcc)' },
      { n: 'ì²´ë¦¬ì†Œë‹¤', h2: '#ff4757', h3: '#e84118', m: '#ffecef', c: 'linear-gradient(135deg,#ff4757,#2f3542)' },
      { n: 'ë¼ë²¤ë”', h2: '#a29bfe', h3: '#6c5ce7', m: '#f0efff', c: 'linear-gradient(135deg,#a29bfe,#6c5ce7)' },
      { n: 'ë¯¼íŠ¸í”„ë ˆì‹œ', h2: '#55efc4', h3: '#00b894', m: '#e8fdf8', c: 'linear-gradient(135deg,#55efc4,#00b894)' },
      { n: 'ìŠ¤ì¹´ì´', h2: '#0984e3', h3: '#74b9ff', m: '#e1f5ff', c: 'linear-gradient(135deg,#0984e3,#74b9ff)' },
      { n: 'ë ˆë“œì™€ì¸', h2: '#c0392b', h3: '#96281b', m: '#f9ebea', c: 'linear-gradient(135deg,#c0392b,#2c3e50)' },
      { n: 'ìŠ¬ë ˆì´íŠ¸', h2: '#95a5a6', h3: '#7f8c8d', m: '#f2f4f4', c: 'linear-gradient(135deg,#95a5a6,#2c3e50)' },
      { n: 'ë¼ì„', h2: '#badc58', h3: '#6ab04c', m: '#f4f9e9', c: 'linear-gradient(135deg,#badc58,#6ab04c)' },
      { n: 'í”¼ì¹˜í•‘í¬', h2: '#ffbe76', h3: '#f0932b', m: '#fff4e6', c: 'linear-gradient(135deg,#ffbe76,#f0932b)' },
      { n: 'ë² ë¦¬í€ì¹˜', h2: '#ff7979', h3: '#eb4d4b', m: '#ffeded', c: 'linear-gradient(135deg,#ff7979,#eb4d4b)' },
      { n: 'ì¸ë””ê³ ', h2: '#4834d4', h3: '#686de0', m: '#ededff', c: 'linear-gradient(135deg,#4834d4,#686de0)' },
      { n: 'ì‹œì•ˆí…Œì¼', h2: '#22a6b3', h3: '#7ed6df', m: '#e0faff', c: 'linear-gradient(135deg,#22a6b3,#7ed6df)' }
    ];

    let state = {
      font: parseInt(localStorage.getItem('f')) || 14,
      scale: parseFloat(localStorage.getItem('s')) || 1.0,
      dark: localStorage.getItem('d') === 'true',
      v: localStorage.getItem('v') || '100',
      t: parseInt(localStorage.getItem('t')) || 0,
      jsonld: '',
      previewClick: localStorage.getItem('pv') === 'true'
    };

    let editor; // CodeMirror or fallback

function createEditor() {
  const ta = document.getElementById('cm-textarea');

  // Fallback: CodeMirror CDN not loaded (offline, blocked, etc.)
  if (typeof CodeMirror === 'undefined') {
    // Show the raw textarea and make it usable
    ta.style.display = 'block';
    ta.style.width = '100%';
    ta.style.height = '100%';
    ta.style.resize = 'none';
    ta.style.border = '0';
    ta.style.outline = 'none';
    ta.style.padding = '14px';
    ta.style.boxSizing = 'border-box';
    ta.style.fontFamily = "'Fira Code','Consolas',monospace";
    ta.style.fontSize = (state.font || 14) + 'px';

    // Minimal editor adapter
    editor = {
      _ta: ta,
      getValue: () => ta.value,
      setValue: (v) => { ta.value = v; },
      focus: () => ta.focus(),
      undo: () => document.execCommand('undo'),
      redo: () => document.execCommand('redo'),
      getSelection: () => {
        const start = ta.selectionStart ?? 0;
        const end = ta.selectionEnd ?? 0;
        return ta.value.substring(start, end);
      },
      replaceSelection: (text) => {
        const start = ta.selectionStart ?? 0;
        const end = ta.selectionEnd ?? 0;
        const before = ta.value.slice(0, start);
        const after = ta.value.slice(end);
        ta.value = before + text + after;
        const pos = start + text.length;
        ta.selectionStart = ta.selectionEnd = pos;
      },
      getCursor: () => ({ line: 0, ch: (ta.selectionStart ?? 0) }),
      setCursor: () => {},
      replaceRange: (text) => {
        // Append at end (simple, predictable)
        ta.value = ta.value + text;
      },
      scrollIntoView: () => {},
      refresh: () => {},
      on: (evt, fn) => {
        if (evt === 'change') ta.addEventListener('input', fn);
      },
      setOption: () => {}
    };

    // Warn once
    setTimeout(() => {
      toast('âš ï¸ CodeMirror ë¡œë”© ì‹¤íŒ¨: ì¸í„°ë„·/ì°¨ë‹¨ í™•ì¸');
    }, 400);

    return;
  }

  // Normal: CodeMirror available
  editor = CodeMirror.fromTextArea(
    ta,
    {
      mode: 'htmlmixed',
      theme: 'monokai',
      lineNumbers: true,
      lineWrapping: true,
      indentUnit: 2,
      tabSize: 2,
      matchBrackets: true,
      extraKeys: {
        'Ctrl-Z': 'undo',
        'Ctrl-Y': 'redo'
      }
    }
  );
}

    function init() {
      createEditor();
      const saved = localStorage.getItem('bhe_content');
      editor.setValue((saved && saved.trim().length>0) ? saved : getDefault());
      apply();
      renderThemes();
      setupRes();
      setupCTAModal();
      setupImgModal();

      editor.on('change', () => {
        clearTimeout(this.tid);
        this.tid = setTimeout(() => {
          render();
          localStorage.setItem('bhe_content', editor.getValue());
        }, 400);
      });

      const pvBtn = document.getElementById('preview-click-toggle');
      if (pvBtn) pvBtn.textContent = state.previewClick ? 'ğŸ”“' : 'ğŸ”’';

      render();
    }

    function apply() {
      document.body.classList.toggle('dark-mode', state.dark);
      document.getElementById('dark-toggle').textContent = state.dark ? 'â˜€ï¸' : 'ğŸŒ™';

      editor.setOption('theme', state.dark ? 'monokai' : 'default');

      const cmEl = document.querySelector('.CodeMirror');
      if (cmEl) cmEl.style.fontSize = state.font + 'px';
      else if (editor && editor._ta) editor._ta.style.fontSize = state.font + 'px';
      document.getElementById('font-size-val').textContent = state.font + 'px';

      document.getElementById('viewport').style.transform = `scale(${state.scale})`;
      document.getElementById('scale-val').textContent = Math.round(state.scale * 100) + '%';

      setVWidth(state.v === '100' ? '100%' : state.v + 'px', state.v);
      render();
    }

    function toggleDarkMode() {
      state.dark = !state.dark;
      localStorage.setItem('d', state.dark);
      apply();
      render();
    }

    function adjustFont(diff) {
      state.font = Math.min(24, Math.max(12, state.font + diff));
      localStorage.setItem('f', state.font);
      apply();
    }

    function adjustScale(diff) {
      state.scale = Math.min(2, Math.max(0.5, state.scale + diff));
      localStorage.setItem('s', state.scale);
      apply();
    }

    function setVWidth(width, mode) {
      state.v = mode;
      localStorage.setItem('v', mode);

      document.getElementById('viewport').style.width = width;

      document
        .querySelectorAll('.view-opt')
        .forEach(btn => btn.classList.toggle('active', btn.id === 'view-' + mode));
    }

    function togglePreviewClickMode() {
      state.previewClick = !state.previewClick;
      localStorage.setItem('pv', state.previewClick);
      const btn = document.getElementById('preview-click-toggle');
      if (btn) btn.textContent = state.previewClick ? 'ğŸ”“' : 'ğŸ”’';
      toast(state.previewClick ? 'ë¯¸ë¦¬ë³´ê¸°: ë§í¬ í´ë¦­ ê°€ëŠ¥' : 'ë¯¸ë¦¬ë³´ê¸°: í´ë¦­=ì½”ë“œ ì„ íƒ');
      render();
    }

    function render() {
      const frame = document.getElementById('preview-frame');
      const viewport = document.getElementById('viewport');
      const doc = frame.contentDocument;
      const code = editor.getValue();
      const t = THEMES[state.t];

      const css = `
        <style>
          body {
            font-family: 'Segoe UI', sans-serif;
            line-height: 1.8;
            color: #333;
            margin: 0;
            padding: 25px;
            background: transparent;
            overflow: visible;
          }
          .wrap {
            max-width: 800px;
            margin: 0 auto;
            padding-bottom: 50px;
          }
          br {
            display: block;
            margin: 15px 0;
            content: "";
          }
          img {
            max-width: 100%;
            height: auto;
            border-radius: 12px;
            display: block;
            margin: 25px auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            cursor: pointer;
          }
          h2 {
            color: ${t.h2};
            border-bottom: 3px solid ${t.h2};
            padding-bottom: 10px;
            margin: 55px 0 25px 0;
            font-size: 1.6rem;
          }
          h3 {
            color: ${t.h3};
            margin: 35px 0 15px 0;
            font-size: 1.3rem;
            border-left: 5px solid ${t.h3};
            padding-left: 10px;
          }
          a {
            color: ${t.h2};
            text-decoration: none;
            font-weight: 600;
          }
          .meta-box {
            background: ${t.m};
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 35px;
            border: 1px solid #ddd;
          }
          .meta-desc-box {
            background: ${t.m};
            border-left: 4px solid ${t.h2};
            padding: 18px 20px;
            margin: 20px 0 30px 0;
            border-radius: 10px;
            font-size: 14px;
            color: #374151;
          }
          .meta-desc-title {
            font-weight: 700;
            font-size: 13px;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            color: ${t.h3};
            margin-bottom: 6px;
          }
          .meta-desc-text { margin: 0; }
          .cta-btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            max-width: 600px;
            background: ${t.c};
            color: #fff !important;
            padding: 18px;
            border-radius: 40px;
            font-weight: 800;
            font-size: 18px;
            text-decoration: none !important;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
            transition: 0.3s;
            margin: 20px auto;
          }
          .cta-btn:hover {
            transform: translateY(-5px);
            filter: brightness(1.1);
          }
          ${state.dark
        ? "body{background:#1e1e1e;color:#ddd;}.meta-box{background:#2a2a2a;border-color:#444;}.meta-desc-box{background:#111827;color:#e5e7eb;border-color:" + t.h3 + ";}"
        : ''}
          .wp-block-image { margin: 0; padding: 0; }
        </style>
      `;

      doc.open();
      doc.write(`
        ${css}
        <body>
          <div class="wrap" id="wp-wrap">
            ${code}
          </div>
          <script>
            window.addEventListener('error', (e) => {
              if (e.message && e.message.includes('ResizeObserver')) {
                e.stopImmediatePropagation();
                return false;
              }
            });
          <\/script>
        </body>
      `);
      doc.close();

      const syncHeight = () => {
        const h = doc.documentElement.scrollHeight;
        frame.style.height = h + 'px';
        viewport.style.height = ((h + 100) * state.scale) + 'px';
      };

      setTimeout(syncHeight, 50);

      if (doc.body) {
        const observer = new ResizeObserver(syncHeight);
        observer.observe(doc.body);
      }

      doc.body.onclick = (e) => {
        if (state.previewClick) return;
        if (e.target === doc.body || e.target.classList.contains('wrap')) {
          openModal('img');
          return;
        }

        const txt = e.target.innerText?.trim().slice(0, 20) || e.target.src;
        if (!txt) return;

        const cur = editor.getSearchCursor(txt, { line: 0, ch: 0 });

        if (cur.findNext()) {
          editor.setSelection(cur.from(), cur.to());
          editor.scrollIntoView(cur.from(), 250);
          editor.focus();
        }
      };
    }

    function renderThemes() {
      const grid = document.getElementById('theme-grid');
      grid.innerHTML = '';

      THEMES.forEach((theme, index) => {
        const card = document.createElement('div');
        card.className = 'theme-card' + (index === state.t ? ' active' : '');
        card.innerHTML = `
          <div class="color-dot" style="background:${theme.h2}"></div>
          <div style="font-size:0.7rem;font-weight:800;">${theme.n}</div>
        `;
        card.onclick = () => {
          state.t = index;
          localStorage.setItem('t', index);
          renderThemes();
          render();
        };
        grid.appendChild(card);
      });
    }

    function openModal(id) {
      document.getElementById('modal-' + id).classList.add('active');
    }

    function closeModal(id) {
      document.getElementById('modal-' + id).classList.remove('active');
    }

    window.addEventListener('click', (e) => {
      if (e.target.classList.contains('modal')) {
        e.target.classList.remove('active');
      }
    });

    window.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        document.querySelectorAll('.modal.active').forEach(m => m.classList.remove('active'));
      }
    });

    function wrapSelection(tag) {
      const selection = editor.getSelection();
      editor.replaceSelection(`<${tag}>${selection}</${tag}>`);

      if (!selection) {
        const cur = editor.getCursor();
        editor.setCursor(cur.line, cur.ch - (tag.length + 3));
      }
      editor.focus();
    }

    function insHighlight() {
      const selection = editor.getSelection();
      const open = '<span style="background-color:#fff3cd; padding:2px 6px; border-radius:6px;"><b>';
      const close = '</b></span>';

      editor.replaceSelection(open + selection + close);

      if (!selection) {
        const cur = editor.getCursor();
        editor.setCursor(cur.line, cur.ch - close.length);
      }
      editor.focus();
    }

    function insAt(text) {
      editor.replaceRange(text + '\n', editor.getCursor());
      editor.focus();
    }

    // ë¹ ë¥¸ ì¤„ë°”ê¿ˆ(íˆ´ë°” í´ë¦­ ì¦‰ì‹œ 1ì¤„ ì‚½ì…)
    function insBRQuick() {
      insAt('<br>');
    }

    function insH() {
      const level = document.getElementById('h-lv').value;
      const text = document.getElementById('h-txt').value;
      insAt(`<h${level}>${text}</h${level}>`);
      closeModal('h');
    }

    /* âœ… ì´ë¯¸ì§€ ëª¨ë‹¬ ê´€ë ¨ */
    function toggleImgLinkField() {
      const imgType = document.getElementById('img-type').value;
      const linkField = document.getElementById('img-link-field');
      const targetField = document.getElementById('img-link-target-field');

      if (imgType === 'linked') {
        linkField.style.display = 'block';
        targetField.style.display = 'block';
      } else {
        linkField.style.display = 'none';
        targetField.style.display = 'none';
      }
    }

    function updateImgSizeSlider() {
      const preset = document.getElementById('img-size-preset').value;
      const sliderField = document.getElementById('img-size-slider-field');
      const slider = document.getElementById('img-size-slider');
      const valueDisplay = document.getElementById('img-size-value');

      if (preset === 'custom') {
        sliderField.style.display = 'block';
      } else {
        sliderField.style.display = 'none';
        slider.value = preset;
        valueDisplay.textContent = preset + '%';
      }
    }

    function setupImgModal() {
      const imgSizeSlider = document.getElementById('img-size-slider');
      const imgSizeValue = document.getElementById('img-size-value');

      imgSizeSlider.addEventListener('input', function () {
        imgSizeValue.textContent = this.value + '%';
      });
    }

    /* âœ… insImg: targetì„ ì•„ì˜ˆ ë„£ì§€ ì•ŠìŒ */
    function insImg() {
      const url = document.getElementById('img-url').value;
      const alt = document.getElementById('img-alt').value;
      const isWP = document.getElementById('wp-mode').checked;
      const imgType = document.getElementById('img-type').value;
      const linkUrl = document.getElementById('img-link-url').value;
      const sizePreset = document.getElementById('img-size-preset').value;
      const sizeSlider = document.getElementById('img-size-slider').value;

      let imgWidth = sizePreset === 'custom' ? sizeSlider : sizePreset;

      let html = "";
      let imgTag = "";

      if (isWP) {
        imgTag = `<img src="${url}" alt="${alt}" class="wp-image-0" style="width: ${imgWidth}%; height: auto; border-radius: 12px;"/>`;
      } else {
        imgTag = `<img src="${url}" alt="${alt}" style="width: ${imgWidth}%; height: auto;">`;
      }

      if (imgType === 'linked' && linkUrl) {
        if (isWP) {
          html = `<figure class="wp-block-image size-full"><a href="${linkUrl}">${imgTag}</a></figure>`;
        } else {
          html = `<a href="${linkUrl}">${imgTag}</a>`;
        }
      } else {
        if (isWP) {
          html = `<figure class="wp-block-image size-full">${imgTag}</figure>`;
        } else {
          html = imgTag;
        }
      }

      insAt(html);
      closeModal('img');
    }

    /* CTA ë²„íŠ¼ ìƒì„± ê´€ë ¨ */
    function adjustBrightness(hex, percent) {
      const num = parseInt(hex.replace("#", ""), 16);
      const amt = Math.round(2.55 * percent);
      const R = (num >> 16) + amt;
      const G = (num >> 8 & 0x00FF) + amt;
      const B = (num & 0x0000FF) + amt;
      return "#" + (0x1000000 +
        (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
        (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
        (B < 255 ? (B < 1 ? 0 : B) : 255))
        .toString(16).slice(1);
    }

    function setupCTAModal() {
      document.querySelectorAll('#modal-cta .color-dot').forEach(dot => {
        dot.addEventListener('click', function () {
          const color = this.getAttribute('data-color');
          const targetId = this.parentElement.previousElementSibling.id;
          document.getElementById(targetId).value = color;
          updateCTAPreview();
        });
      });

      document.getElementById('cta-font-size').addEventListener('input', function () {
        document.getElementById('cta-font-size-value').textContent = this.value + 'px';
        updateCTAPreview();
      });

      [
        'cta-txt', 'cta-url', 'cta-bg-color', 'cta-text-color',
        'cta-width', 'cta-font-size', 'cta-shiny', 'cta-float', 'cta-shadow',
        'cta-gradient', 'cta-hover'
      ].forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.addEventListener('input', updateCTAPreview);
          el.addEventListener('change', updateCTAPreview);
        }
      });

      updateCTAPreview();
    }

    function updateCTAPreview() {
      const txt = document.getElementById('cta-txt').value;
      const bgColor = document.getElementById('cta-bg-color').value;
      const textColor = document.getElementById('cta-text-color').value;
      const width = document.getElementById('cta-width').value;
      const fontSize = document.getElementById('cta-font-size').value;
      const shiny = document.getElementById('cta-shiny').checked;
      const float = document.getElementById('cta-float').checked;
      const shadow = document.getElementById('cta-shadow').checked;
      const gradient = document.getElementById('cta-gradient').checked;

      const preview = document.getElementById('cta-preview');

      let bg = bgColor;
      if (gradient) {
        bg = `linear-gradient(135deg, ${bgColor}, ${adjustBrightness(bgColor, 20)})`;
      }

      let animations = [];
      if (shiny) animations.push('shiny 3s infinite linear');
      if (float) animations.push('float 2s infinite ease-in-out');

      let style = `
        color: ${textColor};
        font-size: ${fontSize}px;
        border-radius: 12px;
        padding: 16px 20px;
        background: ${bg};
        width: ${width};
        height: 60px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        text-decoration: none;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
      `;

      if (animations.length > 0) style += `animation: ${animations.join(', ')};`;
      if (shadow) style += 'box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);';

      if (shiny) {
        style += `
          background-image: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%);
          background-size: 200% 100%;
          background-position: -100% 0;
        `;
      }

      preview.innerHTML = `<a href="#" style="${style}" onclick="return false;">${txt}</a>`;
    }

    /* âœ… insCTA: targetì„ ì•„ì˜ˆ ë„£ì§€ ì•ŠìŒ */
    function insCTA() {
      const txt = document.getElementById('cta-txt').value;
      const url = document.getElementById('cta-url').value;
      const bgColor = document.getElementById('cta-bg-color').value;
      const textColor = document.getElementById('cta-text-color').value;
      const width = document.getElementById('cta-width').value;
      const fontSize = document.getElementById('cta-font-size').value;
      const shiny = document.getElementById('cta-shiny').checked;
      const float = document.getElementById('cta-float').checked;
      const shadow = document.getElementById('cta-shadow').checked;
      const gradient = document.getElementById('cta-gradient').checked;
      const hover = document.getElementById('cta-hover').value;

      const uniqueClass = 'wp-button-' + Math.random().toString(36).substr(2, 9);

      let bg = bgColor;
      if (gradient) bg = `linear-gradient(135deg, ${bgColor}, ${adjustBrightness(bgColor, 20)})`;

      let animations = [];
      if (shiny) animations.push('shiny 3s infinite linear');
      if (float) animations.push('float 2s infinite ease-in-out');

      let hoverStyle = '';
      switch (hover) {
        case 'opacity': hoverStyle = 'opacity: 0.8 !important;'; break;
        case 'scale': hoverStyle = 'transform: scale(1.05) !important;'; break;
        case 'pulse': hoverStyle = 'animation: pulse 0.6s ease-in-out !important;'; break;
      }

      let animationCSS = '';
      if (shiny) animationCSS += '@keyframes shiny { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }\n';
      if (float) animationCSS += '@keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-8px); } }\n';
      if (hover === 'pulse') animationCSS += '@keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }\n';

      const code = `<!-- ì›Œë“œí”„ë ˆìŠ¤ êµ¬í…ë² ë¥´í¬ HTML ë¸”ë¡ í˜¸í™˜ ë²„íŠ¼ -->
<div class="wp-button-container">
  <a href="${url}" class="${uniqueClass}">
    ${txt}
  </a>
</div>
<style>
.wp-button-container {
  display: flex !important;
  justify-content: center !important;
  width: 100% !important;
  margin: 30px 0 !important;
  padding: 6px 0 !important;
  box-sizing: border-box !important;
}
.${uniqueClass} {
  color: ${textColor} !important;
  font-size: ${fontSize}px !important;
  border-radius: 12px !important;
  padding: 12px 20px !important;
  background: ${bg} !important;
  border: none !important;
  width: ${width} !important;
  height: 56px !important;
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  font-family: inherit !important;
  font-weight: bold !important;
  cursor: pointer !important;
  text-decoration: none !important;
  transition: all 0.3s ease !important;
  overflow: hidden !important;
  position: relative !important;
  z-index: 1 !important;
  box-sizing: border-box !important;${animations.length > 0 ? ' animation: ' + animations.join(', ') + ' !important;' : ''}${shiny ? ' background-image: linear-gradient(135deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.3) 50%, rgba(255,255,255,0) 100%) !important; background-size: 200% 100% !important; background-position: -100% 0 !important;' : ''}${shadow ? ' box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15) !important;' : ''}
}
.${uniqueClass}:hover {
  ${hoverStyle}
}
.${uniqueClass}:focus {
  outline: 2px solid ${bgColor} !important;
  outline-offset: 2px !important;
}
${animationCSS}
@media (max-width: 768px) {
  .${uniqueClass} {
    width: 90% !important;
    font-size: ${Math.max(14, fontSize - 4)}px !important;
    padding: 10px 16px !important;
  }
}
.wp-block-html .${uniqueClass} {
  color: ${textColor} !important;
  background: ${bg} !important;
}
</style>`;

      insAt(code);
      closeModal('cta');
    }

    function insTbl() {
      const rows = parseInt(document.getElementById('tbl-r').value, 10);
      const cols = parseInt(document.getElementById('tbl-c').value, 10);

      let html = '<table><thead><tr>';

      for (let j = 0; j < cols; j++) html += '<th>ì œëª©</th>';
      html += '</tr></thead><tbody>';

      for (let i = 0; i < rows; i++) {
        html += '<tr>';
        for (let j = 0; j < cols; j++) html += '<td>ë‚´ìš©</td>';
        html += '</tr>';
      }
      html += '</tbody></table>';

      insAt(html);
      closeModal('tbl');
    }

    /* âœ… insURL: targetì„ ì•„ì˜ˆ ë„£ì§€ ì•ŠìŒ */
    function insURL() {
      const url = document.getElementById('url-val').value;
      const txt = document.getElementById('url-txt').value;
      insAt(`<a href="${url}">${txt}</a>`);
      closeModal('url');
    }


    function __safeText(s) {
      return (s || '').toString().replace(/[<>]/g, '');
    }

    function insAppBlock() {
      const name = (document.getElementById('app-name')?.value || '').trim();
      const iconUrl = (document.getElementById('app-icon')?.value || '').trim();
      const gp = (document.getElementById('app-google')?.value || '').trim();
      const ap = (document.getElementById('app-apple')?.value || '').trim();

      if (!name) { toast('ì•± ì´ë¦„ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”'); return; }
      if (!iconUrl) { toast('ì•„ì´ì½˜ URLì„ ì…ë ¥í•´ ì£¼ì„¸ìš”'); return; }
      if (!gp && !ap) { toast('êµ¬ê¸€/ì• í”Œ ë§í¬ ì¤‘ ìµœì†Œ 1ê°œëŠ” ì…ë ¥í•´ ì£¼ì„¸ìš”'); return; }

      const uid = 'appblk-' + Math.random().toString(36).slice(2, 10);

      const btn = (href, label) => `
        <a href="${href}"
           class="${uid}-btn"
           style="text-decoration:none;">
          <span>${label}</span>
        </a>
      `;

      const buttons = `
        <div class="${uid}-btnwrap">
          ${gp ? btn(gp, 'Google Play') : ''}
          ${ap ? btn(ap, 'App Store') : ''}
        </div>
      `;

      const code = `
<div class="${uid}" style="max-width:520px;margin:22px auto;padding:18px 18px 16px;border:1px solid rgba(0,0,0,0.08);border-radius:18px;background:#ffffff;box-shadow:0 10px 30px rgba(0,0,0,0.08);">
  <div style="display:flex;align-items:center;gap:12px;">
    <img src="${iconUrl}" alt="${name} ì•± ì•„ì´ì½˜" style="width:44px;height:44px;border-radius:12px;display:block;flex:0 0 auto;box-shadow:0 6px 18px rgba(0,0,0,0.12);" loading="lazy" decoding="async">
    <div style="flex:1;min-width:0;">
      <div style="font-size:15px;font-weight:800;color:#111827;line-height:1.2;word-break:keep-all;">${name}</div>
      <div style="font-size:12px;color:#6b7280;margin-top:4px;">ê³µì‹ ìŠ¤í† ì–´ì—ì„œ ì•ˆì „í•˜ê²Œ ì„¤ì¹˜í•˜ì„¸ìš”</div>
    </div>
  </div>

  <div style="height:12px;"></div>

  ${buttons}

  <style>
    .${uid}-btnwrap{display:flex;gap:10px;flex-wrap:wrap;}
    .${uid}-btn{
      display:inline-flex;align-items:center;justify-content:center;
      padding:12px 14px;min-width:140px;flex:1;
      border-radius:14px;border:1px solid rgba(0,0,0,0.10);
      background:linear-gradient(180deg,#ffffff,#f8fafc);
      color:#111827;font-weight:800;font-size:14px;
      box-shadow:0 2px 10px rgba(0,0,0,0.06);
      transition:transform .22s ease, box-shadow .22s ease, border-color .22s ease;
      user-select:none;
    }
    .${uid}-btn:hover{transform:translateY(-3px) scale(1.02);box-shadow:0 10px 22px rgba(0,0,0,0.10);border-color:rgba(0,0,0,0.16);}
    .${uid}-btn:active{transform:translateY(0) scale(1.0);box-shadow:0 4px 14px rgba(0,0,0,0.08);}
    @media (max-width:480px){
      .${uid}{max-width:94% !important;}
      .${uid}-btn{min-width:0;font-size:13px;padding:11px 12px;}
    }
  </style>
</div>`.trim();

      insAt(code);
      closeModal('app');
      toast('ì•± ë¸”ë¡ ì‚½ì… ì™„ë£Œ!');
    }

      // ìŠ¤í† ì–´ ë°°ì§€ ì´ë¯¸ì§€ëŠ” ì‚¬ìš©ìê°€ ë”°ë¡œ URLë¡œ ë„£ëŠ” ë°©ì‹ì´ ì•„ë‹ˆë¼,
// ì‹¬í”Œí•œ í…ìŠ¤íŠ¸ ë²„íŠ¼ìœ¼ë¡œ ì²˜ë¦¬(ìš©ëŸ‰/ì†ë„ ìµœì í™”)
const html = `
<div class="app-dl-wrap">
  <div class="app-dl-card">
    <div class="app-dl-head">
      <div class="app-dl-left">
        ${iconUrl ? `<img class="app-dl-icon" src="${iconUrl}" alt="${name} ì•± ì•„ì´ì½˜" loading="lazy">` : ''}
        <div class="app-dl-meta">
          <div class="app-dl-kicker">ì•± ë‹¤ìš´ë¡œë“œ</div>
          <div class="app-dl-name">${name}</div>
        </div>
      </div>

      <div class="app-dl-actions">
        ${gp ? `<a class="app-dl-btn gp" href="${gp}">Google Play</a>` : ''}
        ${ap ? `<a class="app-dl-btn ap" href="${ap}">App Store</a>` : ''}
      </div>
    </div>
  </div>
</div>

<style>
  .app-dl-wrap{width:100%;margin:18px auto;display:flex;justify-content:center;}
  .app-dl-card{
    width:100%;
    max-width:520px;
    background:#fff;
    border:1px solid #e5e7eb;
    border-radius:18px;
    box-shadow:0 10px 30px rgba(0,0,0,0.06);
    overflow:hidden;
  }
  .app-dl-card:before{
    content:'';
    display:block;
    height:4px;
    background:linear-gradient(90deg,#2563eb,#7c3aed,#ec4899);
  }
  .app-dl-head{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:16px;
    padding:16px 18px 18px;
  }
  .app-dl-left{display:flex;align-items:center;gap:12px;min-width:0;}
  .app-dl-icon{
    width:54px;height:54px;border-radius:14px;flex:0 0 54px;
    object-fit:cover;
    box-shadow:0 8px 18px rgba(0,0,0,0.10);
    background:#f8fafc;
  }
  .app-dl-meta{min-width:0;}
  .app-dl-kicker{
    font-size:12px;font-weight:800;letter-spacing:0.02em;
    color:#2563eb;margin-bottom:3px;
  }
  .app-dl-name{
    font-size:16px;font-weight:900;color:#0f172a;
    white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
  }
  .app-dl-actions{
    display:flex;
    gap:10px;
    flex:0 0 auto;
  }
  .app-dl-btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:10px 14px;
    min-width:132px;
    border-radius:14px;
    font-weight:800;
    font-size:13px;
    text-decoration:none;
    border:1px solid #e5e7eb;
    background:#ffffff;
    color:#111827;
    box-shadow:0 2px 10px rgba(0,0,0,0.06);
    transition:all .25s ease;
    position:relative;
    overflow:hidden;
  }
  .app-dl-btn:hover{
    transform:translateY(-3px) scale(1.03);
    box-shadow:0 10px 18px rgba(0,0,0,0.08);
    border-color:#d1d5db;
  }
  .app-dl-btn:active{transform:translateY(0) scale(1.0);}
  .app-dl-btn.gp:before,.app-dl-btn.ap:before{
    content:'';
    width:10px;height:10px;border-radius:999px;
    margin-right:8px;display:inline-block;flex:0 0 10px;
  }
  .app-dl-btn.gp:before{background:#22c55e;}
  .app-dl-btn.ap:before{background:#111827;}
  @media (max-width:520px){
    .app-dl-head{flex-direction:column;align-items:stretch;}
    .app-dl-actions{width:100%;}
    .app-dl-btn{width:100%;min-width:0;}
    .app-dl-left{justify-content:center;}
    .app-dl-meta{text-align:center;}
  }
</style>`;


      insAt(html);
      closeModal('app');

      // ì…ë ¥ê°’ ìœ ì§€(ë°˜ë³µ ì‘ì—… í¸í•˜ê²Œ). ì›í•˜ë©´ ì•„ë˜ 4ì¤„ ì§€ìš°ë©´ ë¨.
      // document.getElementById('app-name').value = '';
      // document.getElementById('app-icon').value = '';
      // document.getElementById('app-google').value = '';
      // document.getElementById('app-apple').value = '';
    }


        function insertFairTrade() {
      insAt(
        '<p style="color: #888; font-size: 13px; text-align: center; margin-top: 50px;">' +
        'ì¿ íŒ¡ íŒŒíŠ¸ë„ˆìŠ¤ í™œë™ì˜ ì¼í™˜ìœ¼ë¡œ ì¼ì •ì•¡ì˜ ìˆ˜ìˆ˜ë£Œë¥¼ ì œê³µë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.' +
        '</p>'
      );
    }

    function generateTOC() {
      const doc = document.getElementById('preview-frame').contentDocument;
      const headings = doc.querySelectorAll('h2, h3');

      if (!headings.length) return;

      let tocHtml = '<div class="meta-box"><strong>ğŸ“‘ ëª©ì°¨</strong><br>';

      headings.forEach((h, i) => {
        tocHtml += `
<a href="#s${i + 1}"
   style="display:block;margin-top:5px;
          padding-left:${h.tagName === 'H3' ? '20px' : '0'};">
   - ${h.innerText}
</a>`;
      });

      tocHtml += '</div>';

      let content = editor.getValue();

      headings.forEach((h, i) => {
        const tag = `<${h.tagName.toLowerCase()}`;
        const regex = new RegExp(tag + '(?![^>]*id=)', 'i');
        content = content.replace(regex, `${tag} id="s${i + 1}"`);
      });

      editor.setValue(content);
      insAt(tocHtml);
      closeModal('toc');
    }

    function makeJSONLD() {
      const type = document.getElementById('seo-type').value;
      const doc = document.getElementById('preview-frame').contentDocument;

      let schema = {
        '@context': 'https://schema.org',
        '@type': type
      };

      if (type === 'FAQPage') {
        const faqs = [];
        const elements = Array.from(doc.querySelectorAll('p, div, strong, b'));

        elements.forEach((el, i) => {
          const txt = el.innerText.trim();

          if (/^Q\d+\./.test(txt)) {
            for (let j = i + 1; j < Math.min(i + 5, elements.length); j++) {
              const aTxt = elements[j].innerText.trim();

              if (aTxt.startsWith('A.')) {
                faqs.push({
                  '@type': 'Question',
                  name: txt.replace(/^Q\d+\.\s*/, '').trim(),
                  acceptedAnswer: {
                    '@type': 'Answer',
                    text: aTxt.replace(/^A\.\s*/, '').trim()
                  }
                });
                break;
              }
            }
          }
        });

        if (faqs.length > 0) schema.mainEntity = faqs;
      } else {
        schema.headline = doc.querySelector('h2')?.innerText || 'ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… ì œëª©';
      }

      state.jsonld =
        `<script type="application/ld+json">` +
        `${JSON.stringify(schema, null, 2)}<\/script>`;

      document.getElementById('seo-p').innerText = state.jsonld;
      document.getElementById('seo-ins').style.display = 'block';
    }

    function insJSONLD() {
      insAt(state.jsonld);
      closeModal('seo');
    }

    function copyHTML() {
      navigator.clipboard
        .writeText(editor.getValue()).catch(() => { prompt('ë³µì‚¬ (Ctrl+C)', editor.getValue()); })
        .then(() => toast('Copied!'));
    }

    function saveToLocal() {
      localStorage.setItem('bhe_content', editor.getValue());
      toast('Saved!');
    }

    function resetEditor() {
      if (!confirm('ë¦¬ì…‹í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (ì‘ì„± ì¤‘ì¸ ë‚´ìš©ì´ ì´ˆê¸°í™”ë©ë‹ˆë‹¤)')) return;

      localStorage.removeItem('bhe_content');
      editor.setValue(getDefault());
      render();
    }

    function clearCache() {
      if (!confirm('ëª¨ë“  ì„¤ì •(í…Œë§ˆ, ê¸€ì í¬ê¸° ë“±)ê³¼ ì €ì¥ëœ ë‚´ìš©ì„ ì™„ì „íˆ ì‚­ì œí•˜ê³  ì´ˆê¸°í™”í• ê¹Œìš”?')) return;

      localStorage.clear();
      location.reload();
    }

    function toast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2000);
    }

    function setupRes() {
      const resizer = document.getElementById('resizer');
      const leftPane = document.getElementById('editor-pane');
      const rightPane = document.getElementById('preview-pane');

      resizer.onmousedown = (e) => {
        const startX = e.clientX;
        const startWidth = leftPane.offsetWidth;

        document.onmousemove = (me) => {
          const parentWidth = resizer.parentNode.offsetWidth;
          const diffX = me.clientX - startX;
          const percent = (startWidth + diffX) / parentWidth * 100;

          leftPane.style.width = percent + '%';
          rightPane.style.width = (100 - percent) + '%';
        };

        document.onmouseup = () => {
          document.onmousemove = null;
          editor.refresh();
        };
      };
    }

    function getDefault() {
      return `<div style="max-width: 800px; margin: 0 auto; line-height: 1.8; color: #333;">
  <div class="meta-desc-box">
    <div class="meta-desc-title">META DESCRIPTION</div>
    <p class="meta-desc-text">
      ì´ ì˜ì—­ì€ ê²€ìƒ‰ ê²°ê³¼ì— ë…¸ì¶œë˜ëŠ” ë©”íƒ€ë””ìŠ¤í¬ë¦½ì…˜ ì˜ˆì‹œì…ë‹ˆë‹¤. í•µì‹¬ í‚¤ì›Œë“œë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨í•´ 2~3ë¬¸ì¥ìœ¼ë¡œ ìš”ì•½í•´ ì£¼ì„¸ìš”.
    </p>
  </div>

  <h2>ì—ë””í„° ì‚¬ìš©ë²•</h2>
  <p>ìƒë‹¨ íˆ´ë°”ì—ì„œ ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

  <h3>ì£¼ìš” ê¸°ëŠ¥</h3>
  <ul>
    <li>ğŸŒˆ 20ê°€ì§€ í…Œë§ˆ</li>
    <li>ğŸ–¼ï¸ ì´ë¯¸ì§€ ì‚½ì… (ë§í¬ + í¬ê¸° ì¡°ì ˆ)</li>
    <li>âœ¨ ë°˜ì§ì´ëŠ” ë²„íŠ¼ ìƒì„±ê¸°</li>
    <li>ğŸ“‘ ìë™ ëª©ì°¨ ìƒì„±</li>
    <li>ğŸ“ ë©”íƒ€ë””ìŠ¤í¬ë¦½ì…˜ ë°•ìŠ¤</li>
  </ul>

  <div style="text-align:center; margin:34px 0;">
    <a href="https://www.coupang.com" class="cta-btn">ğŸ›’ ë²„íŠ¼ ì˜ˆì‹œ</a>
  </div>

  <h2>ì‹œì‘í•˜ê¸°</h2>
  <p>ì´ì œ ì´ ë‚´ìš©ì„ ì§€ìš°ê³  ììœ ë¡­ê²Œ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
</div>`;
    }

    /* ======================================================
      âœ… í•µì‹¬ ê¸°ëŠ¥ ì¶”ê°€: â€œí…Œë§ˆë¥¼ ì½”ë“œì— ì ìš©(ì¸ë¼ì¸ ë³€í™˜)â€
      - í…Œë§ˆ ì„ íƒì€ ê·¸ëŒ€ë¡œ í”„ë¦¬ë·°ì— ì ìš©
      - ë²„íŠ¼ í´ë¦­ ì‹œ: H2/H3/ë©”íƒ€ë°•ìŠ¤/CTA/í…Œì´ë¸”ì„ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼ë¡œ ì‹¤ì œ ì½”ë“œì— ë°•ìŒ
      - ë°±ì—…/ë˜ëŒë¦¬ê¸° í¬í•¨
      - a íƒœê·¸ target="_blank" ìˆìœ¼ë©´ ì œê±°(ìƒˆì°½ ê¸ˆì§€)
    ====================================================== */
    function __mergeStyle(el, add) {
      const cur = (el.getAttribute('style') || '').trim();
      if (!cur) {
        el.setAttribute('style', add);
        return;
      }
      if (el.getAttribute('data-theme-applied') === '1') return;
      el.setAttribute('style', `${cur}${cur.endsWith(';') ? '' : ';'} ${add}`);
    }

    function applyThemeInline() {
      const t = THEMES[state.t];
      const raw = editor.getValue();

      localStorage.setItem('theme_backup_html', raw);
      localStorage.setItem('theme_backup_time', new Date().toISOString());

      const parser = new DOMParser();
      const doc = parser.parseFromString(`<div id="__root__">${raw}</div>`, 'text/html');
      const root = doc.getElementById('__root__');

      const alreadyWrapped =
        root.querySelector('[data-universal-wrap="1"]') ||
        (root.firstElementChild &&
          ((root.firstElementChild.getAttribute('style') || '').includes('max-width: 800px') ||
            (root.firstElementChild.getAttribute('style') || '').includes('max-width:800px')));

      if (!alreadyWrapped) {
        const wrap = doc.createElement('div');
        wrap.setAttribute('data-universal-wrap', '1');
        wrap.setAttribute(
          'style',
          "max-width:800px;margin:0 auto;line-height:1.8;color:#333;font-family:system-ui,'Segoe UI','Malgun Gothic',sans-serif;"
        );
        while (root.firstChild) wrap.appendChild(root.firstChild);
        root.appendChild(wrap);
      }

      root.querySelectorAll('h2').forEach(h2 => {
        __mergeStyle(
          h2,
          `color:${t.h2};border-bottom:3px solid ${t.h2};padding-bottom:10px;margin:55px 0 25px 0;font-size:1.6rem;`
        );
        h2.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('h3').forEach(h3 => {
        __mergeStyle(
          h3,
          `color:${t.h3};margin:35px 0 15px 0;font-size:1.3rem;border-left:5px solid ${t.h3};padding-left:10px;`
        );
        h3.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('.meta-box').forEach(box => {
        __mergeStyle(
          box,
          `background:${t.m};padding:25px;border-radius:10px;margin-bottom:35px;border:1px solid #ddd;`
        );
        box.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('.meta-desc-box').forEach(box => {
        __mergeStyle(
          box,
          `background:${t.m};border-left:4px solid ${t.h2};padding:18px 20px;margin:20px 0 30px 0;border-radius:10px;font-size:14px;color:#374151;`
        );
        box.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('.meta-desc-title').forEach(tt => {
        __mergeStyle(
          tt,
          `font-weight:700;font-size:13px;letter-spacing:0.05em;text-transform:uppercase;color:${t.h3};margin-bottom:6px;`
        );
        tt.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('.meta-desc-text').forEach(p => {
        __mergeStyle(p, `margin:0;`);
        p.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('a').forEach(a => {
        if (!a.classList.contains('cta-btn')) {
          __mergeStyle(a, `color:${t.h2};text-decoration:none;font-weight:600;`);
          a.setAttribute('data-theme-applied', '1');
        }
        if (a.getAttribute('target') === '_blank') a.removeAttribute('target');
      });

      root.querySelectorAll('img').forEach(img => {
        __mergeStyle(
          img,
          `max-width:100%;height:auto;border-radius:12px;display:block;margin:25px auto;box-shadow:0 4px 20px rgba(0,0,0,0.1);`
        );
        img.setAttribute('data-theme-applied', '1');
      });

      root.querySelectorAll('table').forEach(tbl => {
        __mergeStyle(tbl, `width:100%;border-collapse:collapse;margin:20px 0;`);
        tbl.setAttribute('data-theme-applied', '1');

        tbl.querySelectorAll('th').forEach(th => {
          __mergeStyle(
            th,
            `background:${t.h2};color:#fff;padding:12px;border:1px solid #ddd;text-align:left;`
          );
          th.setAttribute('data-theme-applied', '1');
        });

        tbl.querySelectorAll('td').forEach(td => {
          __mergeStyle(td, `padding:12px;border:1px solid #ddd;`);
          td.setAttribute('data-theme-applied', '1');
        });
      });

      root.querySelectorAll('a.cta-btn').forEach(btn => {
        __mergeStyle(
          btn,
          `display:inline-flex;align-items:center;justify-content:center;width:100%;max-width:600px;background:${t.c};color:#fff;text-decoration:none;padding:18px;border-radius:40px;font-weight:800;font-size:18px;box-shadow:0 10px 20px rgba(0,0,0,0.15);margin:20px auto;`
        );
        btn.setAttribute('data-theme-applied', '1');
        if (btn.getAttribute('target') === '_blank') btn.removeAttribute('target');
      });

      const out = root.innerHTML.trim();
      editor.setValue(out);
      toast('í…Œë§ˆê°€ ì½”ë“œì— ì ìš©ëì–´ìš”!');
    }

    function restoreBeforeTheme() {
      const backup = localStorage.getItem('theme_backup_html');
      if (!backup) {
        toast('ë˜ëŒë¦´ ë°±ì—…ì´ ì—†ì–´ìš”!');
        return;
      }
      editor.setValue(backup);
      toast('ì ìš© ì „ ì½”ë“œë¡œ ë˜ëŒë ¸ì–´ìš”!');
    }

    init();
  </script>
</body>

</html>
